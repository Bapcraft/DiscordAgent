/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a commented-out sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/3.4.1/userguide/tutorial_java_projects.html
 */

/*
// Apply the java plugin to add support for Java
apply plugin: 'java'
apply plugin: 'scala'

// In this section you declare where to find the dependencies of your project
repositories {
    // Use 'jcenter' for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

// In this section you declare the dependencies for your production and test code
dependencies {
    // The production code uses the SLF4J logging API at compile time
    compile 'org.slf4j:slf4j-api:1.7.21'

    // Declare the dependency for your favourite test framework you want to use in your tests.
    // TestNG is also supported by the Gradle Test task. Just change the
    // testCompile dependency to testCompile 'org.testng:testng:6.8.1' and add
    // 'test.useTestNG()' to your build script.
    testCompile 'junit:junit:4.12'
}
*/

plugins {
    id 'org.spongepowered.plugin' version '0.8.1'
    id 'java'
    id 'com.github.johnrengelman.shadow' version '1.2.3'
}

defaultTasks 'build', 'shadowJar'

repositories {
    mavenCentral()
    jcenter()
    maven {
        name 'Sonatype'
        url 'https://oss.sonatype.org/content/repositories/snapshots/'
    }
    maven {
        name 'sponge'
        url 'http://repo.spongepowered.org/maven'
    }
}

group = 'org.bapcraft'
version = '1.0-SNAPSHOT'
description = 'Turn your server into a Discord bot!'

dependencies {
    compile 'org.spongepowered:spongeapi:7.0.0'
    compile 'net.dv8tion:JDA:3.6.0_367'
    compile 'com.google.code.gson:gson:2.8.5'
    
    // All of these are transive via JDA, but needed for the shading.
    compile 'org.apache.commons:commons-lang3'
    compile 'org.apache.commons:commons-collections4:4.1'
    compile 'com.squareup.okhttp3:okhttp:3.10.0'
    compile 'com.squareup.okio:okio:1.14.0'
    compile 'com.neovisionaries:nv-websocket-client:2.4'
    compile 'com.mashape.unirest:unirest-java:1.4.9'
}

task fatJar(type: Jar) {
    baseName = project.name + '-all'
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}

shadowJar {
    dependencies {
    	// TODO Make this not include things we don't need.
        relocate 'org.apache', 'org.bapcraft.shaded.org.apache'
        relocate 'com.google.code.gson', 'org.bapcraft.shaded.com.google.code.gson'
        relocate 'net.dv8tion', 'org.bapcraft.shaded.net.dv8tion'
        relocate 'com.squareup', 'org.bapcraft.shaded.com.squareup'
        relocate 'com.neovisionaries', 'org.bapcraft.shaded.com.neovisionaries'
        relocate 'com.mashape', 'org.bapcraft.shaded.com.mashape'
        relocate 'okio', 'org.bapcraft.shaded.okio'
        include dependency('.*:.*')
        exclude dependency('org.spongepowered:.*')
    }
}

